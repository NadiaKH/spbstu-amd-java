# PHILOSOPHY

### Ошибки и исключения

Ошибки в программах бывают двух видов:
1. Ошибки программиста.
2. Ошибки, которые и ошибками-то вообще не являются. Например, пытаемся открыть файл а его нет, и т.д. Это совершенно ожидаемо.

Для всех типов ошибок в java используются исключения, что сбивает с толку. В [Rust](https://youtu.be/57M2hUnnLCE?t=1950), например, это не так. Там для ошибок программиста возбуждается `паника` (исключение, которое нельзя перехватить, только на границе потока мб), а для обычных ошибок, возвращается специальный результат из функции (вроде `Optional` в джаве, только мощнее).

Обработка ошибок - очень сложная тема. [Исследования](http://joeduffyblog.com/2016/02/07/the-error-model/) показывают, что 90+% больших крахов (когда отрубается датаценр, например) происходит из-за кода, который обрабатывает ошибки. Это происходит потому, что такой код плохо тестируется, потому что исключительные ситуации бывает трудно моделировать.

Отсюда вывод, что нужно стараться не обрабатывать ошибки (wat?).

Поясним.

#### Ошибки программиста

Они приводят программу в невалидное состояние, дальнейшее ее использование может привести к более серьезным ошибкам. Таким образом, при ошибке программиста (выход за границы массива, NullPointerException, ...) следует аккуратно завершить работу программы, предварительно записав информацию об ошибке в лог, например, и уволив случайного разработчика на проекте. 

Если приложение серьезное и ему падать нельзя, то его корректность плюс-минус доказывается формально. Если ошибка все же просочилась, то нужно восстановить программу в корректное состояние. Например, если мы пишем веб-сервер, который каждого клиента обрабатывает в отдельном потоке (так уже никто не делает, см `asinc/await`), то ошибки следует перехватывать на границе потока, логировать и продолжать дальше обрабатывать пользователей. Если дропнули одного пользователя - ничего страшного, обрабатываем остальных, потом разберемся.

#### Ожидаемые ошибки

Ошибки ожидаемые (файл не нашли, например), следует обработать и сообщить пользователю, что файла нет, нужно его положить в правильное место.

Желательно писать программы так, чтобы один и тот же код примерно работал и в случае ошибки, и в случае когда ее нет, тогда больше вероятность, что он будет нормально покрыт тестами.

#### Оформление ошибок в java

При написание модуля, например `MyParser`, программы является хорошим тоном выкидывать исключения, являющиеся подклассом специального `MyParserException`, чтобы пользователь модуля (библиотеки) `MyParser` мог единообразно обрабатывать ошибки, в библиотеке происходящие. Это не относиться обычно к ошибкам программиста.

Если `MyParser` пытается читать файл, может возникнуть `IOException` - проверяемое джавовское исключение, то его следует "завернуть" в исключение своего типа в теле публичного метода, например:
```
public class MyParserIOException extends MyParserException {
  public MyParserIOException(Throwable exception) {
    super(exception);
  }
  // .. other constructors
}

public class MyParser {
  public void readFile(...) {
    try {
      somePrivateMethodThatReadsFile(...);
    } catch (IOException e) {
      throw new MyParserIOException(e);
    }
  }
  // ...
}
```





